(window.webpackJsonpproducts_custormManager=window.webpackJsonpproducts_custormManager||[]).push([["custormManager/views/[request]~views/sysInfo-businessManager-resultsFile-detail"],{48:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("basic-handler",[e.addBtnShowFlag&&e.isUpdateAuthWorkFlow?a("el-button",{attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"small"},on:{click:e.handleAddBtn}},[e._v("新增\n    ")]):e._e(),e._v(" "),e.saveBtnShowFlag?a("el-button",{attrs:{disabled:e.saveBtnDisabledFlag||e.auditBtnDisabledFlag,type:"primary",icon:"el-icon-if-save",size:"small",plain:""},on:{click:e.handleSaveBtn}},[e._v("保存\n    ")]):e._e(),e._v(" "),e.deleteBtnShowFlag&&e.isUpdateAuthWorkFlow?a("el-button",{attrs:{disabled:e.deleteBtnDisabledFlag||!e.detailFormId,type:"danger",icon:"el-icon-delete",size:"small",plain:""},on:{click:e.handleDeleteBtn}},[e._v("删除\n    ")]):e._e(),e._v(" "),e.auditBtnShowFlag&&e.isUpdateAuthWorkFlow?a("el-button",{attrs:{disabled:e.auditBtnDisabledFlag||2!==e.detailForm.validateStatus,type:"primary",icon:"el-icon-if-auth",size:"small",plain:""},on:{click:e.handleAuditBtn}},[e._v("审核\n    ")]):e._e(),e._v(" "),a("basic-see-process",{attrs:{id:e.detailForm.processInstanceId}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-refresh",plain:""},on:{click:e.getDetail}},[e._v("刷新")])],1),e._v(" "),a("el-form",{ref:"refDetailForm",staticClass:"form-container",attrs:{model:e.detailForm,rules:e.rules,"show-message":!1,"label-width":"120px"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("basic-validate-status",{attrs:{model:e.detailForm}})],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"单据编码"}},[a("el-input",{attrs:{disabled:!0,size:"small",clearable:"",placeholder:"系统自动生成单据编码"},model:{value:e.detailForm.code,callback:function(t){e.$set(e.detailForm,"code",t)},expression:"detailForm.code"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"文件名称",prop:"name","hide-required-asterisk":""}},[a("el-input",{ref:"refName",attrs:{disabled:e.disabledFlag,size:"small",clearable:"",maxlength:"100",placeholder:"请输入文件名称"},model:{value:e.detailForm.name,callback:function(t){e.$set(e.detailForm,"name",t)},expression:"detailForm.name"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"客户单位",prop:"cusOrgName","hide-required-asterisk":""}},[a("el-input",{attrs:{disabled:e.disabledFlag,size:"small",readonly:"",placeholder:"请选择客户单位"},model:{value:e.detailForm.cusOrgName,callback:function(t){e.$set(e.detailForm,"cusOrgName",t)},expression:"detailForm.cusOrgName"}},[a("el-button",{staticClass:"form-btn",attrs:{slot:"append",disabled:e.disabledFlag,size:"small",icon:"el-icon-plus"},on:{click:function(t){e.toipClick("unit")}},slot:"append"})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"签字人员"}},[a("el-input",{attrs:{disabled:e.disabledFlag,size:"small",clearable:"",maxlength:"100",placeholder:"请输入签字人员"},model:{value:e.detailForm.signaturePerson,callback:function(t){e.$set(e.detailForm,"signaturePerson",t)},expression:"detailForm.signaturePerson"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"实施人员",prop:"impPerson"}},[a("el-input",{ref:"refImpPerson",attrs:{disabled:e.disabledFlag,size:"small",clearable:"",maxlength:"100",placeholder:"请输入实施人员"},model:{value:e.detailForm.impPerson,callback:function(t){e.$set(e.detailForm,"impPerson",t)},expression:"detailForm.impPerson"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"业务日期",prop:"signDate"}},[a("el-date-picker",{attrs:{editable:!1,clearable:!1,disabled:e.disabledFlag,size:"small",type:"date",format:"yyyy-MM-dd","value-format":"timestamp",placeholder:"选择日期"},model:{value:e.detailForm.signDate,callback:function(t){e.$set(e.detailForm,"signDate",t)},expression:"detailForm.signDate"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"备注说明"}},[a("el-input",{attrs:{disabled:e.disabledFlag,autosize:{minRows:6,maxRows:8},maxlength:5e3,size:"small",clearable:"",type:"textarea",placeholder:"请输入备注说明，不超过5000字"},model:{value:e.detailForm.remark,callback:function(t){e.$set(e.detailForm,"remark",t)},expression:"detailForm.remark"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"add-border file",attrs:{label:"附件"}},[a("basic-upload",{ref:"refBasicUpload",attrs:{disabled:e.disabledFlag,"form-id":e.detailFormId}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:16}},[a("el-form-item",{attrs:{label:"登记人员"}},[a("el-input",{attrs:{disabled:!0,size:"small",clearable:"",placeholder:"系统自动生成登记人员"},model:{value:e.detailForm.inputPerson,callback:function(t){e.$set(e.detailForm,"inputPerson",t)},expression:"detailForm.inputPerson"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"登记时间"}},[a("el-input",{attrs:{disabled:!0,size:"small",clearable:"",placeholder:"系统自动生成登记时间"},model:{value:e.detailForm.inputTime,callback:function(t){e.$set(e.detailForm,"inputTime",t)},expression:"detailForm.inputTime"}})],1)],1)],1)],1),e._v(" "),a("basic-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{visible:e.visibleSyncUnit,title:"产品使用单位-选择"},on:{"update:visible":function(t){e.visibleSyncUnit=t}}},[e.visibleSyncUnit?a("dialog-unit",{on:{selectionChange:e.selectionChange}}):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.visibleSyncUnit=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleChange}},[e._v("确 定")])],1)],1)],1)};i._withStripped=!0;var s=a(64),l=a.n(s),r=a(65),n=a.n(r),o=a(5),d=a.n(o),c=a(55),u=a(56),m=a(58),p=a(59),g=a(33),f=a(60),h=a(34);function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function F(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(Object(a),!0).forEach((function(t){d()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v={name:"ResultsFileDetail",components:{dialogUnit:function(){return a.e("custormManager/null").then(a.bind(null,84))}},mixins:[c.a,u.a,m.a,p.a],props:{isUpdateAuthWorkFlow:{type:Boolean,default:function(){return!0}},reserve:null},data:function(){return{addBtnShowFlag:!0,saveBtnShowFlag:!0,deleteBtnShowFlag:!0,auditBtnShowFlag:!0,saveBtnDisabledFlag:!0,detailForm:{},detailFormId:void 0,rules:{name:[{required:!0,message:"请输入单据名称",trigger:"change"}],cusOrgName:[{required:!0,message:"请选择客户单位",trigger:"change"}],impPerson:[{required:!0,validator:function(e,t,a){Object(f.c)(e,t,a,!0,["实施人员",1,100])},trigger:"change"}],signDate:[{required:!0,message:"请输入业务日期",trigger:"change"}]},apiParams:{productAlias:"smartpm",pageCode:"sysBusResult"},type:null,visibleSyncUnit:!1,selectedRow:{}}},computed:{deleteBtnDisabledFlag:function(){return!!this.$utils.isEmpty(this.detailForm)||2!==this.detailForm.validateStatus},auditBtnDisabledFlag:function(){if(this.validateStatus)return 1!=this.reserve&&this.validateStatus.map((function(e){return Number(e.code)})).includes(this.detailForm.validateStatus)},validateStatus:function(){return Array.isArray(this.dataEnum.auditStatusEnum)?this.dataEnum.auditStatusEnum.filter((function(e){return 1==e.code||3==e.code||4==e.code||5==e.code})):{}},disabledFlag:function(){return this.auditBtnDisabledFlag}},watch:{detailForm:{handler:function(){this.saveBtnDisabledFlag=!1},deep:!0}},deactivated:function(){this.$store.dispatch("cacheId",void 0)},activated:function(){var e=this;this.$utilsBasic.loadAddAndDetailData(this,(function(){e.$route.params&&(e.detailFormId=e.$route.params.id?e.$route.params.id:void 0),e.$route.query&&(e.detailForm.cusOrgId=e.$route.query.id?e.$route.query.id:void 0,e.detailForm.cusOrgName=e.$route.query.name?e.$route.query.name:void 0),e.handleAddBtn()}),(function(t){e.detailFormId=t,e.getDetail()}))},created:function(){this.getEnumData(["GetValidateStatusData"]),this.$store.dispatch("cacheId","0")},methods:{handleAddBtn:function(){this.addDetail()},handleSaveBtn:function(){var e=this;this.validateAfter((function(){e.saveDetailForm().catch((function(e){console.log(e)}))}))},handleDeleteBtn:function(){var e=this;this.$confirm(g.a.info.delete,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.$utils.isEmpty(e.detailFormId)?(e.$set(e.detailForm,"cusOrgId",""),e.$set(e.detailForm,"cusOrgName",""),e.addDetail()):e.deleteDetailForm().then((function(){e.$set(e.detailForm,"cusOrgId",""),e.$set(e.detailForm,"cusOrgName",""),e.addDetail()})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))},handleAuditBtn:function(){var e=this;this.validateAfter((function(){e.$confirm(g.a.info.audit,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.saveDetailForm(!0).then((function(){e.auditDetailForm()})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)}))}))},addDetail:function(){var e=this;this.$nextTick((function(){e.detailFormId=void 0,e.detailForm={id:"",validateStatus:2,cusOrgId:e.detailForm.cusOrgId,cusOrgName:e.detailForm.cusOrgName,name:"",signDate:(new Date).getTime(),inputPerson:e.userLogin.inputPersonFullPath,inputTime:e.$utils.date.format(new Date,"YYYY-MM-DD hh:mm:ss")},e.$refs.refDetailForm.resetFields(),e.$refs.refName.focus(),console.log("this.detailForm",e.detailForm)}))},saveDetailForm:function(e){var t=this,a=this.$utils.copy(this.detailForm);return this.$utils.isEmpty(this.detailFormId)?h.a.static.postObj(F({},this.apiParams,{field:a})).then(function(){var a=n()(l.a.mark((function a(i){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!i.status||200!==i.status){a.next=12;break}return console.log("保存成功",i),t.detailForm.id=i.data.id,t.detailFormId=i.data.id,t.detailForm=Object.assign({},i.data,{signDate:i.data.signDate?new Date(i.data.signDate).getTime():""}),a.next=7,t.$refs.refBasicUpload.submitUpload(i.data);case 7:if(a.sent){a.next=9;break}return a.abrupt("return",!1);case 9:e||t.$message.success(i.message),a.next=13;break;case 12:t.$message({message:i.message,type:"warning"});case 13:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()).catch((function(e){console.log(e)})):h.a.static.putObj(F({},this.apiParams,{field:a})).then(function(){var a=n()(l.a.mark((function a(i){return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!i.status||200!==i.status){a.next=10;break}return t.detailForm=Object.assign({},i.data,{signDate:i.data.signDate?new Date(i.data.signDate).getTime():""}),console.log("修改成功",i),a.next=5,t.$refs.refBasicUpload.submitUpload(i.data);case 5:if(a.sent){a.next=7;break}return a.abrupt("return",!1);case 7:e||t.$message.success(i.message),a.next=11;break;case 10:t.$message({message:i.message,type:"warning"});case 11:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()).catch((function(e){console.log(e)}))},validateAfter:function(e){var t=!0;if(this.$refs.refDetailForm.validate((function(e){return!e&&(t=e),!t})),!t)return this.$message({message:g.a.info.updateEmptyError,type:"warning"}),this.$utilsBasic.valideFocus(this,["refName","refImpPerson"]);"function"==typeof e&&e()},deleteDetailForm:function(){var e=this;return h.a.static.deleteObj(F({},this.apiParams,{field:{id:this.detailFormId}})).then((function(t){t.status&&200===t.status?(e.$message.success(t.message),e.$refs.refBasicUpload.clearAttacheFile()):e.$message({message:t.message,type:"warning"})})).catch((function(e){console.log(e)}))},auditDetailForm:function(){var e=this;return console.log("this.detailForm",this.detailForm),h.a.static.putObjAudit(F({},this.apiParams,{field:this.detailForm})).then((function(t){if(console.log("audit res",t),t.status&&200===t.status){if(e.detailForm=Object.assign({},t.data,{signDate:t.data.signDate?new Date(t.data.signDate).getTime():""}),t.data.processInstanceId)return e.$store.dispatch("OpenSelectUserAndHandleAudit",{processId:t.data.processInstanceId,formData:t.data}).then((function(){e.$message.success(t.message)}));e.$message.success(t.message)}else e.$message({message:t.message,type:"warning"})})).catch((function(e){console.log(e)}))},getDetail:function(){var e=this;if(!this.$utils.isEmpty(this.detailFormId))return h.a.static.getObjDetail(F({},this.apiParams,{field:{id:this.detailFormId}})).then((function(t){t.status&&200===t.status?(console.log("get detailForm",t),e.detailForm=Object.assign({},t.data,{signDate:t.data.signDate?new Date(t.data.signDate).getTime():""})):e.$message({message:t.message,type:"warning"})})).catch((function(e){console.log(e)}));this.addDetail()},toipClick:function(e){this.disabled||(this.type=e,this["visibleSync"+e.replace(/(^[\w\W])/,(function(e){return e.toLocaleUpperCase()}))]=!0)},selectionChange:function(e){console.log("回传row",e),this.selectedRow=e.selectedRow},handleChange:function(){var e=this.selectedRow;if(!this.isSelectedRow(e))return!1;if(0!==Object.keys(e).length){switch(this.type){case"unit":this.detailForm.cusOrgId!==e.id&&(this.detailForm=Object.assign({},this.detailForm,{cusOrgName:e.name,cusOrgId:e.id}))}this.saveBtnDisabledFlag=!1,this["visibleSync"+this.type.replace(/(^[\w\W])/,(function(e){return e.toLocaleUpperCase()}))]=!1}}}},y=a(54),w=Object(y.a)(v,i,[],!1,null,null,null);w.options.__file="src/products/custormManager/views/sysInfo/businessManager/resultsFile/detail.vue";t.default=w.exports}}]);